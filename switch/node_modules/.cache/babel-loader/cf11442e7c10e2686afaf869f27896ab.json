{"ast":null,"code":"'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.createOffline = exports.offline = undefined;\n\nvar _stringify = require('babel-runtime/core-js/json/stringify');\n\nvar _stringify2 = _interopRequireDefault(_stringify);\n\nvar _typeof2 = require('babel-runtime/helpers/typeof');\n\nvar _typeof3 = _interopRequireDefault(_typeof2);\n\nvar _redux = require('redux');\n\nvar _middleware = require('./middleware');\n\nvar _updater = require('./updater');\n\nvar _config = require('./config');\n\nvar _actions = require('./actions');\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n} // @TODO: Take createStore as config?\n\n\nvar warnIfNotReduxAction = function warnIfNotReduxAction(config, key) {\n  var maybeAction = config[key];\n  var isNotReduxAction = maybeAction === null || (typeof maybeAction === 'undefined' ? 'undefined' : (0, _typeof3.default)(maybeAction)) !== 'object' || typeof maybeAction.type !== 'string' || maybeAction.type === '';\n\n  if (isNotReduxAction && console.warn) {\n    var msg = key + ' must be a proper redux action, ' + 'i.e. it must be an object and have a non-empty string type. ' + ('Instead you provided: ' + (0, _stringify2.default)(maybeAction, null, 2));\n    console.warn(msg);\n  }\n};\n/* global $Shape */\n\n\nvar offline = exports.offline = function offline() {\n  var userConfig = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  return function (createStore) {\n    return function (reducer, preloadedState) {\n      var enhancer = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : function (x) {\n        return x;\n      };\n      var config = (0, _config.applyDefaults)(userConfig);\n      warnIfNotReduxAction(config, 'defaultCommit');\n      warnIfNotReduxAction(config, 'defaultRollback'); // wraps userland reducer with a top-level\n      // reducer that handles offline state updating\n\n      var offlineReducer = (0, _updater.enhanceReducer)(reducer, config);\n      var offlineMiddleware = (0, _redux.applyMiddleware)((0, _middleware.createOfflineMiddleware)(config)); // create autoRehydrate enhancer if required\n\n      var offlineEnhancer = config.persist && config.rehydrate && config.persistAutoRehydrate ? (0, _redux.compose)(offlineMiddleware, config.persistAutoRehydrate()) : offlineMiddleware; // create store\n\n      var store = offlineEnhancer(createStore)(offlineReducer, preloadedState, enhancer);\n      var baseReplaceReducer = store.replaceReducer.bind(store);\n\n      store.replaceReducer = function replaceReducer(nextReducer) {\n        return baseReplaceReducer((0, _updater.enhanceReducer)(nextReducer, config));\n      }; // launch store persistor\n\n\n      if (config.persist) {\n        config.persist(store, config.persistOptions, config.persistCallback);\n      } // launch network detector\n\n\n      if (config.detectNetwork) {\n        config.detectNetwork(function (online) {\n          store.dispatch((0, _actions.networkStatusChanged)(online));\n        });\n      }\n\n      return store;\n    };\n  };\n};\n\nvar createOffline = exports.createOffline = function createOffline() {\n  var userConfig = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n  var config = (0, _config.applyDefaults)(userConfig);\n  warnIfNotReduxAction(config, 'defaultCommit');\n  warnIfNotReduxAction(config, 'defaultRollback');\n\n  var enhanceStore = function enhanceStore(next) {\n    return function (reducer, preloadedState, enhancer) {\n      // create autoRehydrate enhancer if required\n      var createStore = config.persist && config.rehydrate && config.persistAutoRehydrate ? config.persistAutoRehydrate()(next) : next; // create store\n\n      var store = createStore(reducer, preloadedState, enhancer);\n      var baseReplaceReducer = store.replaceReducer.bind(store);\n\n      store.replaceReducer = function replaceReducer(nextReducer) {\n        return baseReplaceReducer((0, _updater.enhanceReducer)(nextReducer, config));\n      }; // launch store persistor\n\n\n      if (config.persist) {\n        config.persist(store, config.persistOptions, config.persistCallback);\n      } // launch network detector\n\n\n      if (config.detectNetwork) {\n        config.detectNetwork(function (online) {\n          store.dispatch((0, _actions.networkStatusChanged)(online));\n        });\n      }\n\n      return store;\n    };\n  };\n\n  return {\n    middleware: (0, _middleware.createOfflineMiddleware)(config),\n    enhanceReducer: function enhanceReducer(reducer) {\n      return (0, _updater.enhanceReducer)(reducer, config);\n    },\n    enhanceStore: enhanceStore\n  };\n};","map":null,"metadata":{},"sourceType":"script"}